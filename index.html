<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="left-half" id="leftHalf">
            <p id="locationNameAtRandomLocation">Loading...</p>
            <p id="randomCoordinates">Loading...</p>
            <p id="timeAtRandomLocation">Loading...</p>
            <p>제발 뜨라고 제발제발..</p>
        </div>

        <div class="right-half" id="locationDisplay">
            <p id="userLocationName">Loading...</p> <!-- 사용자 위치의 주소를 표시할 요소 -->
            <p id="locationText">Getting your location...</p>
            <p id="currentTime">Current time: Loading...</p>
        </div>
    </div>
    
    <script>
        const Api_Key = 'AIzaSyBcyfaAihhZ2sghktMI0qsaYxq6S9_Aq8s'; // Google Geocoding API 키

        function generateRandomCoordinatesAndTime() {
            const randomLatitude = Math.random() * (90 - (-90)) + (-90);
            const randomLongitude = Math.random() * (180 - (-180)) + (-180);

            const randomCoordinates = document.getElementById('randomCoordinates');
            randomCoordinates.innerText = `${randomLatitude}, ${randomLongitude}`;

            const timestamp = Math.floor(new Date().getTime() / 1000);

            const timezoneUrl = `https://maps.googleapis.com/maps/api/timezone/json?location=${randomLatitude},${randomLongitude}&timestamp=${timestamp}&key=${Api_Key}`;
            fetch(timezoneUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'OK') {
                        const timeZoneId = data.timeZoneId;
                        const timeAtRandomLocation = document.getElementById('timeAtRandomLocation');
                        setInterval(() => {
                            const currentTime = new Date();
                            const timeAtLocation = currentTime.toLocaleTimeString('en-US', {timeZone: timeZoneId});
                            timeAtRandomLocation.innerText = `${timeAtLocation}`;
                        }, 1000);

                        getLocationName(randomLatitude, randomLongitude, function(locationName) {
                            const locationNameAtRandomLocation = document.getElementById('locationNameAtRandomLocation');
                            locationNameAtRandomLocation.innerText = locationName;
                        });
                    } else {
                        console.error('Failed to fetch timezone data:', data.error_message);
                    }
                })
                .catch(error => console.error('Error fetching timezone data:', error));
        }

        function getLocationName(latitude, longitude, callback) {
            const geocodingUrl = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${latitude},${longitude}&key=${Api_Key}`;
            
            fetch(geocodingUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'OK') {
                        const address = data.results[0].formatted_address;
                        callback(address);
                    } else {
                        console.error('Failed to fetch location data:', data.error_message);
                    }
                })
                .catch(error => console.error('Error fetching location data:', error));
        }

        function showLocation(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            const locationText = document.getElementById('locationText');
            locationText.innerText = `${latitude},${longitude}`;

            getLocationName(latitude, longitude, function(locationName) {
                const userLocationName = document.getElementById('userLocationName');
                userLocationName.innerText = locationName;
            });

            const currentTime = document.getElementById('currentTime');
            setInterval(() => {
                const now = new Date();
                currentTime.innerText = `${now.toLocaleTimeString()}`;
            }, 1000);

            generateRandomCoordinatesAndTime();
        }

        function showError(error) {
            const locationText = document.getElementById('locationText');
            locationText.innerText = `Unable to retrieve your location (${error.code}): ${error.message}`;
        }

        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(showLocation, showError);
        } else {
            const locationText = document.getElementById('locationText');
            locationText.innerText = "Geolocation is not supported by your browser";
        }
    </script>
</body>
</html>

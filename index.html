<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcyfaAihhZ2sghktMI0qsaYxq6S9_Aq8s&callback=initMap" async defer></script>
</head>
<body>
    <div class="container">
        <div class="left-half" id="leftHalf">
            <p id="locationNameAtRandomLocation">Location at random coordinates: Loading...</p>
            <p id="randomCoordinates">Loading...</p>
            <p id="timeAtRandomLocation">Loading...</p>
            <p>제발 뜨라고 제발제발..</p>
        </div>

        <div class="right-half" id="locationDisplay">
            <p id="locationText">Getting your location...</p>
            <p id="currentTime">Current time: Loading...</p>
            <p>This i</p>
        </div>
    </div>
    
    <script>
       // API 키를 상수에 저장
        const apiKey = 'AIzaSyBcyfaAihhZ2sghktMI0qsaYxq6S9_Aq8s'; // 여기에 실제 API 키를 넣으세요

        // Function to generate random coordinates and display time at that location
        function generateRandomCoordinatesAndTime() {
            const randomLatitude = Math.random() * (90 - (-90)) + (-90);
            const randomLongitude = Math.random() * (180 - (-180)) + (-180);

            // Display random coordinates
            const randomCoordinates = document.getElementById('randomCoordinates');
            randomCoordinates.innerText = `${randomLatitude}, ${randomLongitude}`;

            // Get UTC timestamp in seconds
            const timestamp = Math.floor(new Date().getTime() / 1000);

            // Fetch timezone data using API key stored in a variable
            const timezoneUrl = `https://maps.googleapis.com/maps/api/timezone/json?location=${randomLatitude},${randomLongitude}&timestamp=${timestamp}&key=${apiKey}`;
            fetch(timezoneUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'OK') {
                        const timeZoneId = data.timeZoneId;
                        // Display time at random location
                        const timeAtRandomLocation = document.getElementById('timeAtRandomLocation');
                        setInterval(() => {
                            const currentTime = new Date();
                            const timeAtLocation = currentTime.toLocaleTimeString('en-US', {timeZone: timeZoneId});
                            timeAtRandomLocation.innerText = `${timeAtLocation}`;
                        }, 1000); // 1초마다 시간 업데이트

                        // Fetch location name based on coordinates and update location name
                        getLocationName(randomLatitude, randomLongitude);
                    } else {
                        console.error('Failed to fetch timezone data:', data.error_message);
                    }
                })
                .catch(error => console.error('Error fetching timezone data:', error));
        }

        // Function to fetch location name based on coordinates
        function getLocationName(latitude, longitude) {
            const geocoder = new google.maps.Geocoder();
            const latLng = new google.maps.LatLng(latitude, longitude);

            geocoder.geocode({ 'location': latLng }, function(results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        const locationName = results[0].formatted_address;
                        // Update location name at random coordinates
                        const locationNameAtRandomLocation = document.getElementById('locationNameAtRandomLocation');
                        locationNameAtRandomLocation.innerText = "Location at random coordinates: " + locationName;
                    } else {
                        console.error('No results found');
                    }
                } else {
                    console.error('Geocoder failed due to: ' + status);
                }
            });
        }

        // Function to display the user's current location and city
        function showLocation(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            
            // Display latitude and longitude
            const locationText = document.getElementById('locationText');
            locationText.innerText = `${latitude},${longitude}`;

            // Display current time
            const currentTime = document.getElementById('currentTime');
            setInterval(() => {
                const now = new Date();
                currentTime.innerText = `${now.toLocaleTimeString()}`;
            }, 1000); // 1초마다 시간 업데이트

            // Generate random coordinates and display time at that location
            generateRandomCoordinatesAndTime();
        }

        // Function to handle errors when getting the user's location
        function showError(error) {
            const locationText = document.getElementById('locationText');
            locationText.innerText = `Unable to retrieve your location (${error.code}): ${error.message}`;
        }

        // Check if Geolocation is supported by the browser
        if ("geolocation" in navigator) {
            // Get the user's current location
            navigator.geolocation.getCurrentPosition(showLocation, showError);
        } else {
            const locationText = document.getElementById('locationText');
            locationText.innerText = "Geolocation is not supported by your browser";
        }
    </script>
</body>
</html>